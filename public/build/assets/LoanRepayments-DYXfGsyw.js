import{r,j as e,L as w,a as m}from"./app-BYI-4jh4.js";import{V as d}from"./index-C2vhXADF.js";import{A as R}from"./app-layout-CRIVW_7l.js";import{z as f}from"./transition-BnC6KRTQ.js";import{L as x}from"./dialog-DZmXUkRP.js";/* empty css            */import"./button-BOC1bfev.js";import"./index-DtHSLPP3.js";import"./index-CSeUiBDr.js";import"./with-selector-7JA-LM8D.js";function D(){const[u,b]=r.useState([]),[s,n]=r.useState({loan_id:"",amount:"",method:"",date:"",reference:""}),[a,h]=r.useState({}),[N,o]=r.useState(!1),[c,y]=r.useState(null),p=async()=>{try{const t=await m.get("/api/loan-repayments");b(t.data)}catch{d.error("Failed to load repayments")}};r.useEffect(()=>{p()},[]);const j=t=>{h({}),o(!0),t?(n({loan_id:t.loan_id.toString(),amount:t.amount.toString(),method:t.method,date:t.date,reference:t.reference||""}),y(t.id)):(n({loan_id:"",amount:"",method:"",date:"",reference:""}),y(null))},g=async()=>{var t,l;try{c?(await m.put(`/api/loan-repayments/${c}`,s),d.success("Repayment updated")):(await m.post("/api/loan-repayments",s),d.success("Repayment recorded")),o(!1),p()}catch(i){h(((l=(t=i.response)==null?void 0:t.data)==null?void 0:l.errors)||{}),d.error("Validation failed")}},v=async t=>{confirm("Are you sure?")&&(await m.delete(`/api/loan-repayments/${t}`),d.success("Repayment deleted"),p())};return e.jsxs(R,{breadcrumbs:[{title:"Repayments",href:"/repayments"}],children:[e.jsx(w,{title:"Loan Repayments"}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"Loan Repayments"}),e.jsx("button",{onClick:()=>j(),className:"bg-blue-600 text-white px-4 py-2 rounded",children:"âž• New Repayment"})]}),e.jsxs("table",{className:"min-w-full border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"border px-4 py-2",children:"Customer"}),e.jsx("th",{className:"border px-4 py-2",children:"Amount"}),e.jsx("th",{className:"border px-4 py-2",children:"Date"}),e.jsx("th",{className:"border px-4 py-2",children:"Method"}),e.jsx("th",{className:"border px-4 py-2",children:"Ref"}),e.jsx("th",{className:"border px-4 py-2",children:"Actions"})]})}),e.jsxs("tbody",{children:[u.map(t=>{var l,i;return e.jsxs("tr",{children:[e.jsx("td",{className:"border px-4 py-2",children:((i=(l=t.loan)==null?void 0:l.customer)==null?void 0:i.name)||"Unknown"}),e.jsxs("td",{className:"border px-4 py-2",children:["KES ",t.amount]}),e.jsx("td",{className:"border px-4 py-2",children:t.date}),e.jsx("td",{className:"border px-4 py-2",children:t.method}),e.jsx("td",{className:"border px-4 py-2",children:t.reference||"-"}),e.jsxs("td",{className:"border px-4 py-2 space-x-2",children:[e.jsx("button",{onClick:()=>j(t),className:"text-blue-600 hover:underline text-sm",children:"Edit"}),e.jsx("button",{onClick:()=>v(t.id),className:"text-red-600 hover:underline text-sm",children:"Delete"})]})]},t.id)}),u.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"text-center py-4 text-gray-500",children:"No repayments found."})})]})]})]}),e.jsx(f,{appear:!0,show:N,as:r.Fragment,children:e.jsxs(x,{as:"div",className:"relative z-10",onClose:()=>o(!1),children:[e.jsx(f.Child,{as:r.Fragment,enter:"ease-out duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",children:e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-20"})}),e.jsx("div",{className:"fixed inset-0 flex items-center justify-center p-4",children:e.jsxs(x.Panel,{className:"w-full max-w-md bg-white p-6 rounded shadow-lg space-y-4",children:[e.jsx(x.Title,{className:"text-lg font-bold",children:c?"Edit Repayment":"New Repayment"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{type:"number",placeholder:"Loan ID",value:s.loan_id,onChange:t=>n({...s,loan_id:t.target.value}),className:"w-full border p-2 rounded"}),a.loan_id&&e.jsx("p",{className:"text-red-600 text-sm",children:a.loan_id}),e.jsx("input",{type:"number",placeholder:"Amount",value:s.amount,onChange:t=>n({...s,amount:t.target.value}),className:"w-full border p-2 rounded"}),a.amount&&e.jsx("p",{className:"text-red-600 text-sm",children:a.amount}),e.jsx("input",{type:"text",placeholder:"Method (e.g. M-Pesa)",value:s.method,onChange:t=>n({...s,method:t.target.value}),className:"w-full border p-2 rounded"}),a.method&&e.jsx("p",{className:"text-red-600 text-sm",children:a.method}),e.jsx("input",{type:"date",value:s.date,onChange:t=>n({...s,date:t.target.value}),className:"w-full border p-2 rounded"}),a.date&&e.jsx("p",{className:"text-red-600 text-sm",children:a.date}),e.jsx("input",{type:"text",placeholder:"Reference (optional)",value:s.reference,onChange:t=>n({...s,reference:t.target.value}),className:"w-full border p-2 rounded"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>o(!1),className:"bg-gray-300 px-4 py-2 rounded",children:"Cancel"}),e.jsx("button",{onClick:g,className:"bg-blue-600 text-white px-4 py-2 rounded",children:c?"Update":"Save"})]})]})})]})})]})}export{D as default};
